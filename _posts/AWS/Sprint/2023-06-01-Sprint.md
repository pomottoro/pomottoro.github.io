---
title: "23-06-01 Sprint"
excerpt: "Auto Scaling + CloudWatchë¥¼ ì´ìš©í•œ ì•Œë¦¼"

categories: ["Sprint"]
tags: ["Auto Scaling", "CloudWatch"]

date: 2023-06-01
last_modified_at: 2023-06-01
<<<<<<< HEAD

header:
  overlay_image: assets/images/Thumbnail/infinite.jpg
  overlay_filter: 0.5 
  teaser: assets/images/Thumbnail/Sprint-thumbnail.png
published: true
=======
>>>>>>> parent of df92387f (ëŒ€ê·œëª¨ ì—…ë°ì´íŠ¸)
---

# Auto Scaling + CloudWatchë¥¼ ì´ìš©í•œ ì•Œë¦¼

---

>  ì¶”ê°€ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§ì„ í†µí•´ ëª¨ë“  ì§€í‘œë¥¼ í•­ìƒ ê´€ì°°í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, ì£¼ìš” ë©”íŠ¸ë¦­ì˜ ì„ê³„ì¹˜, ë˜ëŠ” ì¥ì•  ë°œìƒ ì˜ˆìƒ ì‹œì (ì˜ˆë¥¼ ë“¤ì–´, CPU ì‚¬ìš©ëŸ‰ì´ 80%ì— ë„ë‹¬í•  ê²½ìš°)ì„ ê²½ë³´ì˜ í˜•íƒœë¡œ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ ê¸°ì¡´ì— ìµí˜”ë˜ SNS ë° ëŒë‹¤ë¥¼ í†µí•´ êµ¬í˜„í•´ ë´…ì‹œë‹¤.

<br>

## ğŸ’¡ Bare Minimum Requirement

- EC2 ì„œë²„ë¥¼ ASGë¥¼ í†µí•´ êµ¬ì„±í•©ë‹ˆë‹¤. êµ¬ì„±ì€ ë‹¤ìŒì„ ë”°ë¦…ë‹ˆë‹¤.
- CloudWatch ì•ŒëŒì„ í†µí•´ ASGì˜ ìŠ¤ì¼€ì¼ ì¸/ì•„ì›ƒì„ ì§„í–‰í•©ë‹ˆë‹¤.
- ìŠ¤ì¼€ì¼ ì¸/ì•„ì›ƒì´ ì§„í–‰ë  ë•Œ ë””ìŠ¤ì½”ë“œì— ì•Œë¦¼ì„ ë³´ëƒ…ë‹ˆë‹¤.
- ë©”íŠ¸ë¦­ì„ ë°”íƒ•ìœ¼ë¡œ ì¥ì•  ë°œìƒ ì˜ˆìƒ ì‹œì ì— ë””ìŠ¤ì½”ë“œì— ì•Œë¦¼ì„ ë³´ëƒ…ë‹ˆë‹¤.
  - CPU ì‚¬ìš©ë¥ (CPUUtilization) ê°’ì´ íŠ¹ì • ê°’ ì´ìƒì¼ ë•Œ ê²½ë³´ê°€ ë°œìƒí•˜ê²Œ í•˜ì„¸ìš”.

---

## ğŸ’¡ ì•Œë¦¼ ë° ê²½ë³´ ì•„í‚¤í…ì²˜

<img width="1302" alt="alert" src="https://github.com/pomottoro/comments/assets/58872932/438da7d6-7ece-4723-a2ae-b079e2d4d56b">

>  EC2 ìˆ˜ì§‘ ì£¼ê¸°ì˜ ê¸°ë³¸ê°’ì€ 5ë¶„ì…ë‹ˆë‹¤. ASGì˜ ê²½ìš° [ì§€í‘œ ìˆ˜ì§‘ í™œì„±í™”]ë¥¼ í†µí•´ ì§€í‘œë¥¼ CloudWatchì— ê¸°ë¡í•©ë‹ˆë‹¤.
>
>  ì´ëŸ¬í•œ ê¸°ë¡ì„ ì´ìš©í•´ ì‹œê°„ì— ë”°ë¥¸ ë©”íŠ¸ë¦­ ì¶”ì´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë•Œ ê²½ë³´ë¥¼ í†µí•´ ì„ê³„ì¹˜ì— ë”°ë¥¸ ë©”ì‹œì§€ê°€ SNSë¡œ ì „ë‹¬ë©ë‹ˆë‹¤. ë˜í•œ ASGì—ì„œ ë°œìƒí•˜ëŠ” ìŠ¤ì¼€ì¼ë§ ì´ë²¤íŠ¸ë¥¼ íŠ¸ë¦¬ê±°í•˜ê¸° ìœ„í•´ ê²½ë³´ ë‘ ê°œ(ìŠ¤ì¼€ì¼ ì¸/ì•„ì›ƒ)ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.
>
>  ì°¸ê³ ë¡œ, CloudWatchì˜ ë©”íŠ¸ë¦­ ë³´ì¡´ ê¸°ê°„ì€ ìˆ˜ì§‘ ì£¼ê¸°ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤. ì„¸ë¶€ ëª¨ë‹ˆí„°ë§ ì˜µì…˜ì„ í™œì„±í™”í•˜ì—¬ ìˆ˜ì§‘ ì£¼ê¸°ë¥¼ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [CloudWatch FAQ](https://aws.amazon.com/ko/cloudwatch/faqs/#AWS_resource_.26_custom_metrics_monitoring)ë¥¼ í†µí•´ í™•ì¸í•˜ì„¸ìš”.

<br>

---

## ğŸ· ì‹œì‘ í…œí”Œë¦¿ êµ¬ì„±

ASGë¥¼ ìœ„í•œ ì‹œì‘ í…œí”Œë¦¿ êµ¬ì„±ì€ ë‹¤ìŒì„ ë”°ë¦…ë‹ˆë‹¤.

- ê·¸ë£¹ ì •ë³´

  - ì›í•˜ëŠ” ìš©ëŸ‰: 1
  - ìµœì†Œ ìš©ëŸ‰: 1
  - ìµœëŒ€ ìš©ëŸ‰: 3

- ì‹œì‘ í…œí”Œë¦¿ì€ ë‹¤ìŒ êµ¬ì„±ì„ ë”°ë¦…ë‹ˆë‹¤.

  - Ubuntu Server (LTS)

  - t2.nano

  - ê¸°ì¡´ í˜¹ì€ ì‹ ê·œ í‚¤ í˜ì–´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤

  - ë³´ì•ˆ ê·¸ë£¹: ì¸ë°”ìš´ë“œ HTTP ë° SSH í—ˆìš©

  - ì‚¬ìš©ì ë°ì´í„°

    ```bash
    #!/bin/bash
    echo "Hello, World" > index.html
    sudo apt update
    sudo apt install stress
    nohup busybox httpd -f -p 80 &
    ```

<br>

![image](https://github.com/pomottoro/comments/assets/58872932/031b80e5-544b-4241-bd8f-05973dfd9c5a)

<br>

- í…œí”Œë¦¿ ì´ë¦„ ì“°ê¸°

<br>

![image](https://github.com/pomottoro/comments/assets/58872932/e5516d02-c3ef-4fa0-9dfe-863783861158)

<br>

![image](https://github.com/pomottoro/comments/assets/58872932/c5128c02-2c5c-42e2-a26f-8f2882100451)

<br>

- ìš”êµ¬ ì‚¬í•­ ëŒ€ë¡œ ìš°ë¶„íˆ¬ LTS ë²„ì „ ìƒì„± ë° t2.nano

<br>

![image](https://github.com/pomottoro/comments/assets/58872932/e5281628-1afd-4524-985a-d17b7d2b3f47)

<br>

- í‚¤í˜ì–´ ë° ë„¤íŠ¸ì›Œí¬ ì„¤ì •

<br>

![image](https://github.com/pomottoro/comments/assets/58872932/22099504-ba27-4ae5-a3d2-0982ae3db0fb)

<br>

- **ê³ ê¸‰ ì„¸ë¶€ ì •ë³´** ì œì¼ ì•„ë˜ ìª½ ì‚¬ìš©ì ë°ì´í„°ì— ë‚´ìš© ì¶”ê°€

![image](https://github.com/pomottoro/comments/assets/58872932/b33a36b5-6529-47f3-8cad-fce31d3a2198)

<br>

- í…œí”Œë¦¿ ìƒì„± ë²„íŠ¼ ëˆ„ë¥´ë©´ ìƒì„± ì™„ë£Œ

![image](https://github.com/pomottoro/comments/assets/58872932/f0761789-f650-4ad2-a58f-527f2a559946)

<br>





---

- ë§Œë“¤ì–´ì§„ í…œí”Œë¦¿ìœ¼ë¡œ Auto Scaling ê·¸ë£¹ ìƒì„±

![image](https://github.com/pomottoro/comments/assets/58872932/809a1f62-12be-4a29-b2ef-e186356479ae)

<br>

![image](https://github.com/pomottoro/comments/assets/58872932/17832adc-fbe4-442e-b54d-e54e568abd13)

<br>

![image](https://github.com/pomottoro/comments/assets/58872932/3ff6fb49-f2ec-41bf-bb3a-93144fa431b9)


<br>

![image](https://github.com/pomottoro/comments/assets/58872932/c0d9dd4a-916a-4014-94d3-7aadd53bb0fb)

<br>

![image](https://github.com/pomottoro/comments/assets/58872932/040363bf-9e09-4a04-bba2-98d1501db59d)

<br>

![image](https://github.com/pomottoro/comments/assets/58872932/d87d81dc-94c5-4348-9752-5acb61c202ad)

<br>

![](https://github.com/pomottoro/comments/assets/58872932/71fd77fc-d040-436d-aeea-f29b2ed623eb)

<br>

![image](https://github.com/pomottoro/comments/assets/58872932/f5f48a86-0b2c-4406-b2ac-d3e73ecfda31)

- Auto Scaling ê·¸ë£¹ ìƒì„± ì™„ë£Œ

---

- Cloud Watch ê²½ë³´ ë©”ì‹œì§€ ë°œì†¡ì„ ìœ„í•œ SNS ì£¼ì œ ìƒì„±

![image](https://github.com/pomottoro/comments/assets/58872932/0f7c68e3-3280-4e32-8701-236ba960cd93)

---

## ğŸ· CloudWatchì™€ ì¡°ì • ì •ì±…

- CloudWatchë¥¼ í†µí•œ Auto Scaling ê·¸ë£¹ ì§€í‘œ ìˆ˜ì§‘ í™œì„±í™” í•„ìš”
- Scale-in ì¡°ê±´: CPU 40% ì´í•˜
- Scale-out ì¡°ê±´: CPU 50% ì´ìƒ

---

- CloudWatch ê²½ë³´ ìƒì„±

![image](https://github.com/pomottoro/comments/assets/58872932/c67a8a7b-6a2f-46f9-bd02-443d98e7a87a)

<br>

![image](https://github.com/pomottoro/comments/assets/58872932/0bfea585-ba12-4fe5-906b-0e189e7f10ee)

<br>

![image](https://github.com/pomottoro/comments/assets/58872932/bdbac0d3-3145-4a8b-b83b-b8bee08ed205)

<br>

![image](https://github.com/pomottoro/comments/assets/58872932/18d82067-9369-4e09-864b-55074adb815f)

<br>

![image](https://github.com/pomottoro/comments/assets/58872932/60bacae2-0a7c-4334-b850-310931704ced)

- ê°™ì€ ë‚´ìš©ìœ¼ë¡œ Scale in ê²½ë³´ ì¶”ê°€ ìƒì„±

![image](https://github.com/pomottoro/comments/assets/58872932/ce3e5195-3820-44c5-a4ae-5cc7a92a6564)

![image](https://github.com/pomottoro/comments/assets/58872932/97d091c7-6bda-4958-90ac-778ac4d49aed)

<br>

![image](https://github.com/pomottoro/comments/assets/58872932/a9c499ec-01b4-4f43-a7b6-4b7bba858b9a)

---

- ê²½ë³´ê°€ ìš¸ë¦¬ë©´ ìë™ìœ¼ë¡œ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±, ì¶”ê°€ë¥¼ í•  ìˆ˜ ìˆë„ë¡ Auto Scaling ê·¸ë£¹ì—ì„œ ì¶”ê°€ ì •ì±… ìƒì„±

![image](https://github.com/pomottoro/comments/assets/58872932/b1beb05e-15b6-48c8-8781-3362bba05048)

<br>

![image](https://github.com/pomottoro/comments/assets/58872932/8390443b-f634-4d79-b6e5-821deacbba38)

- ë§ˆì°¬ê°€ì§€ë¡œ Scale in ì •ì±…ë„ ì¶”ê°€ ìƒì„±

![image](https://github.com/pomottoro/comments/assets/58872932/29b82270-f51f-40c1-8516-75a5419e0444)

<br>

![image](https://github.com/pomottoro/comments/assets/58872932/b2181d92-bcca-4118-9539-9cdc573017eb)

<br>

---

### Lambda ì½”ë“œ

- [Python 3.x ë²„ì „ì˜ ì–¸ì–´ë¡œ ì‘ì„±ëœ ì½”ë“œ](https://gist.github.com/gotoweb/0f993bdc19833e76f7860608181bedac)ê°€ ì¤€ë¹„ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•´ ëŒë‹¤ í•¨ìˆ˜ë¥¼ ìƒì„±í•˜ì„¸ìš”.
- ë””ìŠ¤ì½”ë“œ ì›¹í›… URLì€ `HOOK_URL` í™˜ê²½ë³€ìˆ˜ë¥¼ ì´ìš©í•´ ì¶”ê°€í•˜ë©°, ë‹¤ìŒ URLì„ ì…ë ¥í•´ ë„£ìŠµë‹ˆë‹¤.

```
https://discord.com/api/webhooks/1102396954543128618/785PFD5H5ORooihWDdipYdVsFQdSwETMypye-X9EavBTrhXGg8DyBLRJW66EGad6XIpD
```

- ì½”ë“œì˜ `username` ë¶€ë¶„ì— `CloudWatch Monitoring` ëŒ€ì‹ , ì—¬ëŸ¬ë¶„ì˜ ì´ë¦„ì„ ì ì–´ ë„£ìœ¼ì„¸ìš”.

ì´ í•¨ìˆ˜ëŠ”, `cloudwatch-alarm-to-slack-python` ë¸”ë£¨í”„ë¦°íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

---

### ğŸ· ëŒë‹¤  í•¨ìˆ˜ ìƒì„±

![image](https://github.com/pomottoro/comments/assets/58872932/ee2a26d9-a6f6-424b-a82d-bca128f228d8)

<br>

![image](https://github.com/pomottoro/comments/assets/58872932/2593515d-9dee-401b-8a8e-f93d2dbd3737)

- í•¨ìˆ˜ ì½”ë“œ ë„£ê³  ìš”êµ¬ ì‚¬í•­ëŒ€ë¡œ ì‘ì„± í›„ Deploy

![image](https://github.com/pomottoro/comments/assets/58872932/19688dce-9bb1-4929-8ae9-8a712746dd10)

- SNS ë¡œ ë©”ì‹œì§€ê°€ ë„ì°©í•˜ë©´ ëŒë‹¤ê°€ íŠ¸ë¦¬ê±° ë  ìˆ˜ ìˆë„ë¡ êµ¬ì„±

![image](https://github.com/pomottoro/comments/assets/58872932/ea53997b-029b-4c0c-b34e-fc7f810c8526)

- í™˜ê²½ ë³€ìˆ˜ì— ì›¹í›… URL ì£¼ì†Œ ì¶”ê°€

ì´ê±¸ë¡œ í•„ìš”í•œ êµ¬ì„±ì€ ì „ë¶€ ë§Œë“¤ì—ˆê¸° ë•Œë¬¸ì— í…ŒìŠ¤íŠ¸ë§Œ ì§„í–‰ í•˜ë©´ ëœë‹¤.

---

## ë¶€í•˜ í…ŒìŠ¤íŠ¸

ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ì„œ `stress` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ë©´, CPUë¥¼ 100%ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. `top`ëª…ë ¹ì–´ë¥¼ í†µí•´ì„œ ì •ë§ 100%ë¥¼ ì‚¬ìš©í•˜ëŠ”ì§€ í™•ì¸í•´ ë³´ì„¸ìš”.

```bash
$ stress -c 1
```

- AWS CLI ë¡œ EC2 ì ‘ì† í›„ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì§„í–‰

![image](https://github.com/pomottoro/comments/assets/58872932/6b5ceac5-cf3c-46ab-936f-8614eb9a3a83)

![image](https://github.com/pomottoro/comments/assets/58872932/34a7469e-47bc-4dfd-85be-5f2726163ba8)
![image](https://github.com/pomottoro/comments/assets/58872932/ab860680-f83a-44bc-83e3-3f177b094d4f)



- CPU ì‚¬ìš©ë¥ ì— ë”°ë¼ Discord ì— ì•Œë¦¼ì´ ê°„ë‹¤.

<br>

---

<br>